import{r as i,j as s}from"./index-xl9o6DcG.js";const ie=({value:R="",onChange:o,onSend:j,placeholder:Y="Type a message...",disabled:f=!1,isLoading:x=!1,maxLength:u,showCharacterCount:q=!1,enableMediaUpload:A=!1,mediaButton:l,enableVoiceInput:$=!1,voiceButton:e,sendButton:a,className:J="",inputClassName:O="",autoFocus:Q=!1,autoGrow:N=!0,maxRows:S=10,error:m=!1,errorMessage:k,ariaLabel:Z="Message input",sendAriaLabel:_="Send message",mediaAriaLabel:P="Attach media",voiceAriaLabel:v="Record voice message",theme:d="light",closeIcon:U})=>{const[n,M]=i.useState(R),[h,E]=i.useState(null),[C,z]=i.useState(null),[G,V]=i.useState(""),[D,W]=i.useState([]),[H,L]=i.useState(!1),b=i.useRef(null),y=i.useRef(null),T=i.useRef(null),F=i.useRef(`chat-input-error-${Math.random().toString(36).substr(2,9)}`);i.useEffect(()=>{M(R)},[R]),i.useEffect(()=>{if(b.current){N&&(b.current.style.height="auto");const r=b.current.scrollHeight,t=r>52;if(t!==H&&L(t),N){const p=24*S,g=`${Math.min(r,p)}px`;b.current.style.height=g}}},[n,N,S,H]);const B=r=>{const t=r.target.value;u&&t.length>u||(M(t),o==null||o(t))},X=()=>{var t;if(f||x)return;const r=n.trim();!r&&!h||(j==null||j(r,h||void 0),V("Message sent"),setTimeout(()=>V(""),1e3),M(""),E(null),z(null),o==null||o(""),b.current&&(b.current.style.height="auto"),(t=b.current)==null||t.focus())},ee=r=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&(r.preventDefault(),X())},re=r=>{var c,p;const t=(c=r.target.files)==null?void 0:c[0];if(t){if(E(t),(p=l==null?void 0:l.onUpload)==null||p.call(l,t),t.type.startsWith("image/")){const g=new FileReader;g.onload=I=>{var w;return z((w=I.target)==null?void 0:w.result)},g.readAsDataURL(t)}y.current&&(y.current.value="")}},le=()=>{E(null),z(null)},ae=r=>{if(!T.current)return;const c=T.current.getBoundingClientRect(),p=Math.max(c.width,c.height),g=r.clientX-c.left-p/2,I=r.clientY-c.top-p/2,w={x:g,y:I,size:p,id:Date.now()};W(se=>[...se,w])};i.useEffect(()=>{if(D.length===0)return;const r=setTimeout(()=>{W(t=>t.slice(1))},600);return()=>clearTimeout(r)},[D]);const K=f||x||!n.trim()&&!h;return s.jsxs("div",{className:`flex flex-col gap-2 w-full max-w-250 mx-auto p-4 ${d==="dark"?"bg-input-bg-dark":"bg-input-bg"} ${J}`,role:"form","aria-label":"Message input form",children:[s.jsx("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",children:G}),m&&k&&s.jsx("div",{id:F.current,role:"alert","aria-live":"assertive",className:"text-xs text-red-600 px-2 mb-1",children:k}),h&&C&&s.jsxs("div",{className:"relative inline-block mb-2",children:[s.jsx("img",{src:C,alt:"Selected media preview",className:`w-16 h-16 sm:w-20 sm:h-20 object-cover rounded-lg border ${d==="dark"?"border-input-border-dark":"border-input-border"}`}),s.jsx("button",{onClick:le,className:"absolute -top-2 -right-2 min-w-[28px] min-h-[28px] w-7 h-7 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors",type:"button","aria-label":"Remove media attachment",children:U?i.cloneElement(U,{size:14}):null})]}),s.jsxs("div",{className:`relative flex items-end ${d==="dark"?"bg-input-bg-dark border-input-border-dark/50 hover:border-input-border-dark/70 focus-within:border-input-border-focus":"bg-input-bg border-input-border/50 hover:border-input-border/70 focus-within:border-input-border-focus"} rounded-3xl border transition-all ${H?"pb-13":""}`,children:[A&&s.jsxs(s.Fragment,{children:[s.jsx("input",{ref:y,type:"file",accept:(l==null?void 0:l.accept)||"image/*",onChange:re,className:"hidden",disabled:f||x||(l==null?void 0:l.disabled),"aria-label":P,id:"media-upload-input"}),(l==null?void 0:l.component)||s.jsx("button",{onClick:()=>{var r;return(r=y.current)==null?void 0:r.click()},disabled:f||x||(l==null?void 0:l.disabled),className:`absolute left-2 bottom-1.5 p-2 ${d==="dark"?"text-input-placeholder-dark border-input-border-dark hover:text-input-text-dark hover:bg-menu-hover-bg-dark":"text-input-placeholder border-input-border hover:text-input-text hover:bg-menu-hover-bg"} rounded-full transition-all disabled:opacity-50 disabled:cursor-not-allowed border hover:border-transparent ${(l==null?void 0:l.className)||""}`,type:"button","aria-label":P,"aria-describedby":m&&k?F.current:void 0,children:l!=null&&l.icon?i.cloneElement(l.icon,{size:20}):null})]}),s.jsx("textarea",{ref:b,value:n,onChange:B,onKeyDown:ee,placeholder:Y,disabled:f||x,autoFocus:Q,rows:1,className:`block w-full px-4 py-3 bg-transparent border-0 resize-none focus:outline-none ${d==="dark"?"text-input-text-dark placeholder:text-input-placeholder-dark disabled:text-input-placeholder-dark/60":"text-input-text placeholder:text-input-placeholder disabled:text-input-placeholder/60"} text-base min-h-11 ${A?"pl-14":""} ${!$||n.trim()||h?"pr-14":"pr-4"} ${O}`,style:{maxHeight:`${24*S}px`},"aria-label":Z,"aria-invalid":m,"aria-describedby":m&&k?F.current:void 0,"aria-multiline":"true"}),q&&u&&s.jsxs("span",{className:`absolute right-14 bottom-3 text-xs ${d==="dark"?"text-input-placeholder-dark":"text-input-placeholder"} pointer-events-none`,"aria-live":"polite","aria-atomic":"true",children:[n.length,"/",u]}),$&&!n.trim()&&!h&&s.jsx(s.Fragment,{children:(e==null?void 0:e.component)||s.jsx("button",{onMouseDown:e==null?void 0:e.onStartRecording,onMouseUp:e==null?void 0:e.onStopRecording,onMouseLeave:e==null?void 0:e.onStopRecording,onTouchStart:e==null?void 0:e.onStartRecording,onTouchEnd:e==null?void 0:e.onStopRecording,disabled:f||x||(e==null?void 0:e.disabled),className:`absolute right-2 bottom-1/2 translate-y-1/2 p-2 ${d==="dark"?"text-input-placeholder-dark hover:text-input-text-dark hover:bg-menu-hover-bg-dark border-input-border-dark":"text-input-placeholder hover:text-input-text hover:bg-menu-hover-bg border-input-border"} rounded-full select-none transition-all border disabled:cursor-not-allowed ${(e==null?void 0:e.className)||""}`,type:"button","aria-label":e!=null&&e.isRecording?"Recording voice message, release to stop":v,"aria-pressed":e==null?void 0:e.isRecording,children:e!=null&&e.icon?i.cloneElement(e.icon,{size:20}):null})}),(!$||n.trim()||h)&&s.jsx(s.Fragment,{children:(a==null?void 0:a.component)||s.jsxs("button",{ref:T,onClick:r=>{ae(r),((a==null?void 0:a.onClick)||X)()},disabled:(a==null?void 0:a.disabled)!==void 0?a.disabled:K,className:`absolute right-2 bottom-1.5 p-2 rounded-full transition-all disabled:cursor-not-allowed overflow-hidden border ${K?d==="dark"?"bg-transparent text-button-disabled-text border-input-border-dark":"bg-transparent text-button-disabled-text border-input-border":"bg-button-primary-bg text-button-primary-text hover:bg-button-primary-bg-hover active:scale-95 border-transparent"} ${(a==null?void 0:a.className)||""}`,type:"button","aria-label":_,"aria-disabled":(a==null?void 0:a.disabled)!==void 0?a.disabled:K,children:[D.map(r=>s.jsx("span",{className:"absolute rounded-full bg-white opacity-30 animate-ripple pointer-events-none",style:{left:r.x,top:r.y,width:r.size,height:r.size,animation:"ripple 600ms ease-out"}},r.id)),a!=null&&a.icon?i.cloneElement(a.icon,{size:20}):null]})})]})]})};export{ie as C};
