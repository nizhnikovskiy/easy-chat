import{j as s,r as n}from"./index-BEcDo9m9.js";import{C as D}from"./ChatInput-BhoqKlwr.js";import{M as f}from"./Message-CqX55SDZ.js";import"./StaticMessage-ytEklB7k.js";import{T as L}from"./TypingMessage-BXdrciyU.js";import"./AssistantMessage-COnDFLMF.js";import"./TypingAssistantMessage-Bl5Ffrdf.js";import{b as G,c as H,d as P}from"./MessageContextMenu-Cnrkk1Eh.js";import{c as V}from"./chat-bg-k3BMNxlV.js";const W=({date:r})=>s.jsx("div",{className:"flex justify-center items-center my-4",children:s.jsx("div",{className:"bg-gray-800 bg-opacity-60 text-white text-xs px-3 py-1.5 rounded-full shadow-sm",children:r})}),q=()=>{const[r]=n.useState(!1);return{isReflectionFinished:r}},se=({messages:r,isPending:m,onSendMessage:b,messagesEndRef:y,isHistoryCompleted:x=!1,backgroundImage:S=V,contextMenuConfig:l,onEditMessage:d,onDeleteMessage:u})=>{q();const[v,g]=n.useState(""),[N,T]=n.useState(!1),[U,j]=n.useState(null),[w,E]=n.useState(0),k=e=>{const a=[{id:"copy",label:"Copy",icon:s.jsx(P,{size:16}),onClick:t=>{const i=parseInt((t==null?void 0:t.replace("msg-",""))||"0"),o=r[i];o&&"content"in o&&navigator.clipboard.writeText(o.content)}}];return e&&(a.push({id:"edit",label:"Edit",icon:s.jsx(G,{size:16}),onClick:t=>{if(d&&t){const i=parseInt(t.replace("msg-","")),o=r[i];if(o&&"content"in o){const c=prompt("Edit message:",o.content);c!==null&&d(t,c)}}},disabled:!d}),a.push({id:"delete",label:"Delete",icon:s.jsx(H,{size:16}),onClick:t=>{u&&t&&confirm("Are you sure you want to delete this message?")&&u(t)},disabled:!u,divider:!0})),a};n.useEffect(()=>{E(r.length)},[]);const A=e=>{if(e!==r.length-1||e<w)return!1;const a=r[e];if("type"in a&&a.type==="date")return!1;const t=a;return t.role!=="user"&&!t.isTypingComplete},R={backgroundImage:`url("${S}")`,backgroundRepeat:"repeat",width:"100%",height:"100%",backgroundSize:"cover"},B=e=>{j(e)},z=(e,a,t)=>{const i=e!==void 0?e:v,o=a!==void 0?a:U;!i.trim()&&!o||(b(i.trim(),o||void 0,t),g(""),j(null),T(!0))},F=()=>{setTimeout(()=>{var e;(e=y.current)==null||e.scrollIntoView({behavior:"smooth"})},100)};return s.jsx("div",{className:"h-full w-full overflow-hidden",children:s.jsxs("div",{className:"h-[calc(100vh-5rem)] flex flex-col",style:R,children:[s.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden w-full max-w-250 p-4 mx-auto",children:[s.jsxs("div",{style:{paddingBottom:"1rem"},children:[r.map((e,a)=>{if("type"in e&&e.type==="date")return s.jsx(W,{date:e.date},`date-${a}`);const t=e,i=t.role==="user",o=i?"user":"other",c=A(a),C=a>=w?i?"animate-slide-in-right":"animate-slide-in-left":"",$=`msg-${a}`;let p;if((l==null?void 0:l.enabled)!==!1)if(l!=null&&l.items)p=l.items;else{const I=k(i);p=l!=null&&l.customItems?[...I,...l.customItems]:I}const h={sender:o,showAvatar:!0,showUsername:!1,showTimestamp:!1,groupPosition:"standalone",className:C,messageId:$,contextMenuItems:p};return t.image?s.jsx(f,{...h,content:s.jsxs(s.Fragment,{children:[s.jsx("img",{src:t.image,alt:"Uploaded",style:{maxWidth:"100%",borderRadius:"0.5rem",marginBottom:"0.5rem"}}),s.jsx("div",{children:t.content})]})},a):c?s.jsx(L,{...h,text:t.content,typingSpeed:15,onComplete:F},a):s.jsx(f,{...h,content:t.content},a)}),m&&s.jsx(f,{sender:"other",showAvatar:!0,showUsername:!1,showTimestamp:!1,groupPosition:"standalone",content:s.jsx("span",{style:{animation:"pulse 1.5s ease-in-out infinite"},children:"..."})})]}),s.jsx("div",{ref:y})]}),!x&&s.jsx("div",{className:"w-full",children:s.jsx(D,{value:v,onChange:e=>g(e),onSend:(e,a)=>z(e,a),disabled:m,isLoading:m,enableMediaUpload:!0,mediaButton:{accept:"image/*",onUpload:B},placeholder:"Enter message...",autoFocus:N,autoGrow:!0,maxRows:10,className:"bg-transparent"})})]})})};var J=(r=>(r.USER="user",r.ASSISTANT="assistant",r.TEACHER="teacher",r))(J||{});export{se as C,J as M};
